const t=document.createElement("div");function i(t,i,s,e){t.addEventListener(i,s,!e&&!1!==e||e)}function s(t,i,s,e){t.removeEventListener(i,s,!e&&!1!==e||e)}function e(t,i){t.stopPropagation(),t.cancelable&&t.preventDefault()}function o(t,i){return t.getElementsByClassName(i)[0]}function n(t,i){t.classList.add(i)}function h(t,i){t.classList.remove(i)}function r(t,i,s){s=""+s,t["_s_"+i]!==s&&(t.style.setProperty(i,s),t["_s_"+i]=s)}t.innerHTML="<div class=wb-header><div class=wb-icon><span class=wb-min></span><span class=wb-max></span><span class=wb-full></span><span class=wb-close></span></div><div class=wb-title> </div></div><div class=wb-body></div><div class=wb-n></div><div class=wb-s></div><div class=wb-w></div><div class=wb-e></div><div class=wb-nw></div><div class=wb-ne></div><div class=wb-se></div><div class=wb-sw></div>";const c=[];let l,m,d,u,a,f,p,w,b=0,v=0;function x(s,n){if(!(this instanceof x))return new x(s);let h,c,d,u,v,y,M,E,_,q,F,L,N,R,T,H,B,D,P,U,X,Y,j,O,S,V,W;m||(l=document.body,l[a="requestFullscreen"]||l[a="msRequestFullscreen"]||l[a="webkitRequestFullscreen"]||l[a="mozRequestFullscreen"]||(a=""),f=a&&a.replace("request","exit").replace("mozRequest","mozCancel").replace("Request","Exit"),i(window,"resize",(function(){k(),z()})),k()),this.dom=t.cloneNode(!0),this.body=o(this.dom,"wb-body"),s&&(n&&(d=s,s=n),"string"==typeof s?d=s:((D=s.modal)&&(F=L="center"),h=s.id,c=s.root,d=d||s.title,u=s.mount,v=s.html,y=s.url,M=s.width,E=s.height,_=s.minwidth,q=s.minheight,F=s.x||F,L=s.y||L,N=s.max,R=s.top,T=s.left,H=s.bottom,B=s.right,m=s.index||m,P=s.onclose,U=s.onfocus,X=s.onblur,Y=s.onmove,j=s.onresize,O=s.background,S=s.border,V=s.class,W=s.splitscreen,O&&this.setBackground(O),S&&r(this.body,"margin",S+(isNaN(S)?"":"px")))),this.setTitle(d||"");let A=p,G=w;R=R?g(R,G):0,H=H?g(H,G):0,T=T?g(T,A):0,B=B?g(B,A):0,A-=T+B,G-=R+H,M=M?g(M,A):A/2|0,E=E?g(E,G):G/2|0,_=_?g(_,A):0,q=q?g(q,G):0,F=F?g(F,A,M):T,L=L?g(L,G,E):R,m=m||10,this.dom.id=this.id=h||"winbox-"+ ++b,this.dom.className="winbox"+(V?" "+("string"==typeof V?V:V.join(" ")):"")+(D?" modal":""),this.x=F,this.y=L,this.width=M,this.height=E,this.minwidth=_,this.minheight=q,this.top=R,this.right=B,this.bottom=H,this.left=T,this.border=S,this.min=!1,this.max=!1,this.onclose=P,this.onfocus=U,this.onblur=X,this.onmove=Y,this.onresize=j,this.splitscreen=W,N?this.maximize():this.move().resize(),this.focus(),u?this.mount(u):v?this.body.innerHTML=v:y&&this.setUrl(y),function(t){C(t,"title"),C(t,"n"),C(t,"s"),C(t,"w"),C(t,"e"),C(t,"nw"),C(t,"ne"),C(t,"se"),C(t,"sw"),i(o(t.dom,"wb-min"),"click",(function(i){e(i),t.minimize()})),i(o(t.dom,"wb-max"),"click",(function(i){e(i),t.focus().maximize()})),a?i(o(t.dom,"wb-full"),"click",(function(i){e(i),t.focus().fullscreen()})):t.addClass("no-full");i(o(t.dom,"wb-close"),"click",(function(i){e(i),t.close()||(t=null)})),i(t.dom,"click",(function(i){t.focus()}),!1)}(this),(c||l).appendChild(this.dom)}function g(t,i,s){if("string"==typeof t)if("center"===t)t=(i-s)/2|0;else if("right"===t||"bottom"===t)t=i-s;else{const s=parseFloat(t),e=""+s!==t&&t.substring((""+s).length);t="%"===e?i/100*s|0:s}return t}function y(t){c.splice(c.indexOf(t),1),z(),t.removeClass("min"),t.min=!1,t.dom.title=""}function z(){const t=c.length,i={},s={};for(let e,o,n=0;n<t;n++)e=c[n],o=e.left+":"+e.top,s[o]?s[o]++:s[o]=1;for(let e,o,n,h=0;h<t;h++)e=c[h],o=e.left+":"+e.top,n=Math.min((p-e.left-e.right)/s[o],250),i[o]||(i[o]=0),e.resize(n+1|0,35,!0).move(e.left+i[o]*n|0,w-e.bottom-35,!0),i[o]++}function C(t,r){const c=o(t.dom,"wb-"+r);let m,d,u;function a(s){if(e(s),t.min)t.minimize();else{if("title"===r){const i=Date.now(),s=i-v;if(v=i,s<250)return void t.maximize()}t.max||(n(l,"wb-drag"),(m=s.touches)&&(m=m[0])?(s=m,i(window,"touchmove",f),i(window,"touchend",b)):(i(window,"mousemove",f),i(window,"mouseup",b)),d=s.pageX,u=s.pageY,t.focus())}}function f(i){e(i),m&&(i=i.touches[0]);const s=i.pageX,o=i.pageY,n=s-d,h=o-u;let c,l,a,f;"title"===r?(t.x+=n,t.y+=h,a=f=1):("e"===r||"se"===r||"ne"===r?(t.width+=n,c=1):"w"!==r&&"sw"!==r&&"nw"!==r||(t.x+=n,t.width-=n,c=1,a=1),"s"===r||"se"===r||"sw"===r?(t.height+=h,l=1):"n"!==r&&"ne"!==r&&"nw"!==r||(t.y+=h,t.height-=h,l=1,f=1)),(c||l)&&(c&&(t.width=Math.max(Math.min(t.width,p-t.x-t.right),150)),l&&(t.height=Math.max(Math.min(t.height,w-t.y-t.bottom),35)),t.resize()),(a||f)&&(a&&(t.x=Math.max(Math.min(t.x,p-t.width-t.right),t.left)),f&&(t.y=Math.max(Math.min(t.y,w-t.height-t.bottom),t.top)),t.move()),d=s,u=o}function b(t){e(t),h(l,"wb-drag"),m?(s(window,"touchmove",f),s(window,"touchend",b)):(s(window,"mousemove",f),s(window,"mouseup",b))}i(c,"mousedown",a),i(c,"touchstart",a,{passive:!1})}function k(){p=l.clientWidth,w=l.clientHeight}function M(t){if(d=!1,document.fullscreen||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)return document[f](),!0}x.new=function(t){return new x(t)},x.prototype.mount=function(t){return this.unmount(),t._backstore||(t._backstore=t.parentNode),this.body.textContent="",this.body.appendChild(t),this},x.prototype.unmount=function(t){const i=this.body.firstChild;if(i){const s=t||i._backstore;s&&s.appendChild(i),i._backstore=t}return this},x.prototype.setTitle=function(t){var i,s;return i=o(this.dom,"wb-title"),s=this.title=t,i.firstChild.nodeValue=s,this},x.prototype.setBackground=function(t){return r(this.dom,"background",t),this},x.prototype.setUrl=function(t){return this.body.innerHTML='<iframe src="'+t+'"></iframe>',this},x.prototype.focus=function(){return u!==this&&(r(this.dom,"z-index",m++),this.addClass("focus"),u&&(u.removeClass("focus"),u.onblur&&u.onblur()),u=this,this.onfocus&&this.onfocus()),this},x.prototype.hide=function(){return this.addClass("hide")},x.prototype.show=function(){return this.removeClass("hide")},x.prototype.minimize=function(t){return d&&M(),!t&&this.min?(y(this),this.resize().move().focus()):!1===t||this.min||(c.push(this),z(),this.dom.title=this.title,this.addClass("min"),this.min=!0),this.max&&(this.removeClass("max"),this.max=!1),this},x.prototype.maximize=function(t){return void 0!==t&&t===this.max||(this.min&&y(this),(this.max=!this.max)?this.addClass("max").resize(p-this.left-this.right,w-this.top-this.bottom,!0).move(this.left,this.top,!0):this.resize().move().removeClass("max")),this},x.prototype.fullscreen=function(t){return void 0!==t&&t===d||(this.min&&(this.resize().move(),y(this)),d&&M()||(this.body[a](),d=!0)),this},x.prototype.close=function(t){if(this.onclose&&this.onclose(t))return!0;this.min&&y(this),this.unmount(),this.dom.parentNode.removeChild(this.dom),u===this&&(u=null)},x.prototype.move=function(t,i,s){return t||0===t?s||(this.x=t?t=g(t,p-this.left-this.right,this.width):0,this.y=i?i=g(i,w-this.top-this.bottom,this.height):0):(t=this.x,i=this.y,this.splitscreen&&(0===t||t===p-this.width)&&this.resize(p/2,w)),r(this.dom,"transform","translate("+t+"px,"+i+"px)"),this.onmove&&this.onmove(t,i),this},x.prototype.resize=function(t,i,s){return t||0===t?s||(this.width=t?t=g(t,p-this.left-this.right):0,this.height=i?i=g(i,w-this.top-this.bottom):0):(t=this.width,i=this.height),t=Math.max(t,this.minwidth),i=Math.max(i,this.minheight),r(this.dom,"width",t+"px"),r(this.dom,"height",i+"px"),this.onresize&&this.onresize(t,i),this},x.prototype.addClass=function(t){return n(this.dom,t),this},x.prototype.removeClass=function(t){return h(this.dom,t),this};export{x as default};
